<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    <script src="map_locations.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <script src="ext/bimap.min.js"></script>
    <script src="korokMap.min.js"></script>
    <script src="a.js"></script>
    <script src="b.js"></script>
    <script src="seeds.js"></script>
    <script src="data.js"></script>
    <style>
        #botw-map {
            height: 700px;
            width: 100%;
        }

        .leaflet-container {
            background-color: rgba(0, 0, 0, 0);
        }

        .leaflet-marker-icon {
            border-width: 0px;
            background-color: rgba(0, 0, 0, 0);

        }

        .leaflet-marker-icon img {
            position: relative;
            top: -50%;
            left: -50%;
        }
    </style>
</head>

<body>
    <div id="botw-map" style=""></div>
    <script>
        function drawPoints(dataArray, imgURL = "icons/marker.png", divClass = "", tooltipFunction = null, titleFunction = null) {
            for (var x = 0; x < dataArray.length + 0; x++) {
                var i = x % 900;
                var tooltip = null;
                if (tooltipFunction !== null) {
                    tooltip = tooltipFunction(dataArray[i]);
                }
                var title = "";
                if (titleFunction !== null) {
                    title = "title='" + titleFunction(dataArray[i]) + "'";
                }
                var coords = dataArray[i].coords;
                var marker = L.marker([-(coords[1]), coords[0]], {
                    icon: L.divIcon({
                        html: "<img " + title + " class='" + divClass + "' src='" + imgURL + "'>"
                    })
                });
                if (tooltip !== null && Array.isArray(tooltip) && tooltip.length === 2) {
                    marker.bindTooltip(tooltip[0], tooltip[1]);
                };
                marker.addTo(map);
            }
        }

        function convertCoords(lat,
            lng) {
            //converts coordinates from ZeldaDungeon to ObjectMap
            var newLat = ((lat - 0.714) * 11645.0168512) - 529.562734724;
            var newLng = ((lng - 0.3422) * 11647.9425212) - 8163.65502938;
            return [newLat, newLng];
        }

        function distance(x1, x2, y1, y2) {
            var a = x1 - x2;
            var b = y1 - y2;

            return Math.sqrt(a * a + b * b);
        }

        function getNearestObjMapKorok(zdCoords) {
            var minI = 0;
            var minDist = -1;
            for (var i = 0; i < obj_shrines.length; i++) {
                var dist = distance(zdCoords[0],
                    obj_shrines[i][0], -zdCoords[1],
                    obj_shrines[i][1]);
                if (minDist === -1 || dist < minDist) {
                    minI = i;
                    minDist = dist;
                }
            }
            console.log(minI);
            return minI;
        }
        var map = L.map('botw-map', {
            preferCanvas: true,
            minZoom: -4,
            maxZoom: 4,
            center: [0, 0],
            zoom: -4,
            crs: L.CRS.Simple
        });
        var southWest = map.unproject([-6000, 5000], 0);
        var northEast = map.unproject([6000, -5000], 0);
        var bounds = new L.LatLngBounds(southWest, northEast);
        L.imageOverlay('BotW-Map.png', bounds).addTo(map);
        map.setMaxBounds(bounds);

        drawPoints(DATA.seeds, "icons/korok.png", "", function(korok) {
            return ["SSN: " + korok.id + ", ZDN: " + korok.zd_id + ", OBJ: " + korok.obj_map_id, {
                direction: "top"
            }];
        });

        drawPoints(DATA.shrines, "icons/shrine.png", "", function(shrine) {
            return ["Name: " + shrine.id, {
                direction: "top"
            }]
        });
        drawPoints(DATA.towers, "icons/tower.png", "", function(tower) {
            return ["Name: " + tower.id, {
                direction: "top"
            }]
        });

        //console.log(DATA.seeds);

        //        var zdSeedArr = [];
        //        for (var i = 0; i < zd_dist.length; i++) {
        //            zdSeedArr[zdSeedArr.length] = {
        //                zd_id: zd_dist[i].id,
        //                coords: convertCoords(zd_dist[i].coords[0][0], zd_dist[i].coords[0][1])
        //            };
        //        }
        //        for (var i = 0; i < zd_seeds.length; i++) {
        //            zdSeedArr[zdSeedArr.length] = {
        //                zd_id: zd_seeds[i].properties.id,
        //                coords: convertCoords(zd_seeds[i].geometry.coordinates[0], zd_seeds[i].geometry.coordinates[1])
        //            }
        //        }
        //        var iList = [];
        //        var duplicates = [];
        //        for (var i = 0; i < zdSeedArr.length; i++) {
        //            var nearest = asdf[getNearestObjMapKorok(zdSeedArr[i].coords)];
        //            zdSeedArr[i].nearest = nearest;
        //            zdSeedArr[i].objKorok = getNearestObjMapKorok(zdSeedArr[i].coords);
        //            if (typeof iList.find(function(currentValue) {
        //                    return currentValue.nearest === nearest;
        //                }) !== "undefined") {
        //                duplicates[duplicates.length] = zdSeedArr[i];
        //            } else {
        //                iList[iList.length] = zdSeedArr[i];
        //            }
        //            L.marker([-(nearest[1]), nearest[0]], {
        //                icon: L.divIcon({
        //                    html: "<img title='" + zdSeedArr[i].zd_id + "' src='icons/korok.png'>"
        //                })
        //            });
        //        }
        //        for (var i = 0; i < duplicates.length; i++) {
        //            var x = 0;
        //            iList.forEach(function(currentValue) {
        //                if (currentValue.nearest === duplicates[i].nearest) {
        //                    console.log(x, currentValue, i, duplicates[i]);
        //                }
        //                x++;
        //            });
        //        }
    </script>
</body>

</html>
