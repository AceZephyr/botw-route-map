<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>
    <script src="map_locations.js"></script>
    <script src="korokMap.min.js"></script>
    <script src="data.js"></script>
    <style>
        * {
            margin: 0;
            border: 0;
            padding: 0;
        }

        #botw-map-container {
            width: 100%;
            background-color: #000;
        }

        #botw-map {
            float: left;
            height: 100%;
            width: 80%;
        }

        #botw-map-right {
            float: right;
            width: 20%;
            height: 100%;
        }

        #botw-map-buttons {
            height: 80%;
            width: 100%;
        }

        #botw-map-buttons #botw-button-backwards {
            width: 100%;
            height: 20%;
            background-color: red;
            cursor: pointer;
        }

        #botw-map-buttons #botw-button-forwards {
            width: 100%;
            height: 80%;
            background-color: green;
            cursor: pointer;
        }

        #botw-map-buttons #botw-button-backwards:active,
        #botw-map-buttons #botw-button-forwards:active {
            position: relative;
            top: 1px;
            left: 1px;
        }

        #botw-map-buttons #botw-button-backwards:active {
            background-color: lightcoral;
        }

        #botw-map-buttons #botw-button-forwards:active {
            background-color: lightgreen;
        }

        #botw-map-search {
            background-color: white;
            height: 100%;
        }

        #botw-map-search-box {
            border: 1px solid black;
            width: 100%;
        }

        .leaflet-container {
            background-color: rgba(0, 0, 0, 0);
        }

        .leaflet-marker-icon {
            border-width: 0px;
            background-color: rgba(0, 0, 0, 0);

        }

        .leaflet-marker-icon img {
            position: relative;
            top: -50%;
            left: -50%;
        }
    </style>
</head>

<body>
    <div id="botw-map-container">
        <div id="botw-map"></div>
        <div id="botw-map-right">
            <div id="botw-map-buttons">
                <input type="button" value="Backwards" id="botw-button-backwards">
                <input type="button" value="Forwards" id="botw-button-forwards">
            </div>
            <div id="botw-map-search">
                <p>Search for something</p>
                <input type="search" name="botw-map-search-box" id="botw-map-search-box">
            </div>
        </div>
    </div>
    <script>
        $(window).resize(setMapSize);

        function setMapSize() {
            $('#botw-map-container').css("height", (window.innerHeight) * (2 / 3));
        }
        setMapSize();

        function drawPoints(dataArray, imgURL = "icons/marker.png", divClass = "", tooltipFunction = null,
            titleFunction = null) {
            for (var x = 0; x < dataArray.length + 0; x++) {
                var i = x % 900;
                var tooltip = null;
                if (tooltipFunction !== null) {
                    tooltip = tooltipFunction(dataArray[i]);
                    if (typeof tooltip === "string") {
                        tooltip = [tooltip, {}]
                    }
                    if (typeof tooltip[1].direction === "undefined") {
                        tooltip[1].direction = "top";
                    }
                }
                var title = "";
                if (titleFunction !== null) {
                    title = "title='" + titleFunction(dataArray[i]) + "'";
                }
                var coords;

                if (typeof dataArray[i].coords !== "undefined") {
                    coords = dataArray[i].coords;

                } else if (Array.isArray(dataArray[i]) && dataArray[i].length === 2) {
                    coords = dataArray[i];
                }
                var marker = L.marker([-(coords[1]), coords[0]], {
                    icon: L.divIcon({
                        html: "<img " + title + " class='" + divClass + "' src='" + imgURL + "'>"
                    })
                });
                if (tooltip !== null && Array.isArray(tooltip) && tooltip.length === 2) {
                    marker.bindTooltip(tooltip[0], tooltip[1]);
                };
                marker.addTo(map);
            }
        }

        var map = L.map('botw-map', {
            preferCanvas: true,
            minZoom: -4,
            maxZoom: 4,
            center: [0, 0],
            zoom: -4,
            crs: L.CRS.Simple
        });
        var southWest = map.unproject([-6000, 5000], 0);
        var northEast = map.unproject([6000, -5000], 0);
        var bounds = new L.LatLngBounds(southWest, northEast);
        L.imageOverlay('BotW-Map.png', bounds).addTo(map);
        map.setMaxBounds(bounds);

        drawPoints(DATA.seeds, "icons/korok.png", "", function (korok) {
            return ["SSN: " + korok.id + ", ZDN: " + korok.zd_id + ", OBJ: " + korok.obj_map_id, {
                direction: "top"
            }];
        });

        drawPoints(DATA.shrines, "icons/shrine.png", "", function (shrine) {
            return shrine.id;
        });
        drawPoints(DATA.towers, "icons/tower.png", "", function (tower) {
            return tower.id;
        });
        drawPoints(locations.FldObj_FirstShrine_A_01.locations, "icons/shrine-of-resurrection.png", "", function (
            shrine) {
            return "Shrine of Resurrection";
        })
        drawPoints(locations.Item_CookSet.locations, "icons/icon-pot.png", "", function (pot) {
            return "Cooking Pot";
        });
        drawPoints(locations.Item_CookSet_PanOnly.locations, "icons/icon-pot.png", "", function (pot) {
            return "Cooking Pot (Pan Only)";
        });
        drawPoints(locations.TwnObj_AncientReactorFurnace_A_01.locations, "icons/tech-lab.png", "", function (lab) {
            return "Hateno Ancient Tech Lab";
        });
        drawPoints(locations.TwnObj_AncientReactorFurnace_B_01.locations, "icons/tech-lab.png", "", function (lab) {
            return "Akkala Ancient Tech Lab";
        });

        /*function convertCoords(lat,
            lng) {
            //converts coordinates from ZeldaDungeon to ObjectMap
            var newLat = ((lat - 0.714) * 11645.0168512) - 529.562734724;
            var newLng = ((lng - 0.3422) * 11647.9425212) - 8163.65502938;
            return [newLat, newLng];
        }

        function distance(x1, x2, y1, y2) {
            var a = x1 - x2;
            var b = y1 - y2;

            return Math.sqrt(a * a + b * b);
        }

        function getNearestObjMapKorok(zdCoords) {
            var minI = 0;
            var minDist = -1;
            for (var i = 0; i < obj_shrines.length; i++) {
                var dist = distance(zdCoords[0],
                    obj_shrines[i][0], -zdCoords[1],
                    obj_shrines[i][1]);
                if (minDist === -1 || dist < minDist) {
                    minI = i;
                    minDist = dist;
                }
            }
            console.log(minI);
            return minI;
        } */
    </script>
</body>

</html>